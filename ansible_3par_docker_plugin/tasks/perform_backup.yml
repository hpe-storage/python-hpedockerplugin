  - name: Check if package is already installed
    yum:
      list: etcdtool
    register: is_installed

  - name : Install the etcdtool binary
    yum: 
      name: https://github.com/mickep76/etcdtool/releases/download/3.3.1/etcdtool-3.3-201605021949.x86_64.rpm 
    when: >-
      ( is_installed.results | length == 0 )  or
      ( is_installed.results | length == 1 and is_installed.results[0].version == "3.3" and is_installed.results[0].yumstate != "installed")       

  - name: Perform backup using export command
    shell: etcdtool -p "http://{{hostvars[inventory_hostname]['ansible_default_ipv4']['address']}}:23790" -d export / -o /tmp/hpe_etcd_data.json
    register: backup
    become: yes
    
  

